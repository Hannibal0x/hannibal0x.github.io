# 2021首届鹤城杯WriteUp（MISC+CRYPTO）

<div class="has-toc have-toc">
</div>

## 0x00 MISC 流量分析

打开timu.pcapng，发现有明显的sql注入痕迹。<figure class="wp-block-image size-full">

<img loading="lazy" width="3081" height="371" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片.png" alt="" class="wp-image-3934" /> </figure> 

追踪tcp流，不断点击跳转，找不同，在第70个流时，发现返回了You are in 的信息，猜想应该是sql注入的猜解成功了。<figure class="wp-block-image size-full">

<img loading="lazy" width="2655" height="1825" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-1.png" alt="" class="wp-image-3935" /> </figure> 

过滤一下are字符串，顺着找出其他返回成功的ascii码值<figure class="wp-block-image size-full">

<img loading="lazy" width="1912" height="113" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-2.png" alt="" class="wp-image-3936" /> </figure> 

最后得到`102 108 97 103 123 119 49 114 101 115 104 65 82 75 95 101 122 95 49 115 110 116 105 116 125`，解出`flag{w1reshARK_ez_1sntit}`

## 0x01 MISC NEW_MISC

打开pdf，法语，看起来像是在说隐写术。<figure class="wp-block-image size-full">

<img loading="lazy" width="1984" height="1790" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-3.png" alt="" class="wp-image-3937" /> </figure> 

对于pdf的隐写题，先直接上wbs43open<figure class="wp-block-image size-full is-resized">

<img loading="lazy" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-4.png" alt="" class="wp-image-3938" width="581" height="387" /> </figure> 

将解密结果导出到1.txt，即可得到`flag{verY_g00d_YoU_f0und_th1s}`。<figure class="wp-block-image size-full is-resized">

<img loading="lazy" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-5.png" alt="" class="wp-image-3939" width="234" height="77" /> </figure> 

## 0x02 CRYPTO EASY_ CRYPTO 

给了一个文本，很明显是核心价值观编码。

```
公正公正公正诚信文明公正民主公正法治法治诚信民主自由敬业公正友善公正平等平等法治民主平等平等和谐敬业自由诚信平等和谐平等公正法治法治平等平等爱国和谐公正平等敬业公正敬业自由敬业平等自由法治和谐平等文明自由诚信自由平等富强公正敬业平等民主公正诚信和谐公正文明公正爱国自由诚信自由平等文明公正诚信富强自由法治法治平等平等自由平等富强法治诚信和谐
```

在<a rel="noreferrer noopener" href="https://www.amanctf.com/tool/cvecode" target="_blank" rel="nofollow" >https://www.amanctf.com/tool/cvecode</a>解一下，得到`flag{IlUqU9O5guX6YiITsRNPiQmbhNRjGuTP}`。

## 0x03 MISC A_MISC

压缩包加了密，随便爆破一下，解出qwer<figure class="wp-block-image size-full is-resized">

<img loading="lazy" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-6.png" alt="" class="wp-image-3941" width="629" height="319" /> </figure> 

得到一张不全的图<figure class="wp-block-image size-full is-resized">

<img loading="lazy" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-7.png" alt="" class="wp-image-3942" width="439" height="294" /> </figure> 

怀疑存在高度隐写，改一下高度，出现完整的信息.<figure class="wp-block-image size-full">

<img loading="lazy" width="1033" height="114" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-8.png" alt="" class="wp-image-3943" /> </figure> 

是一个file.pcap，下载下来分析一下，发现里面有盲注的痕迹。<figure class="wp-block-image size-full">

<img loading="lazy" width="2656" height="1826" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-9.png" alt="" class="wp-image-3944" /> </figure> 

url解密一下就能看得更清楚一些。<figure class="wp-block-image size-full">

<img loading="lazy" width="1926" height="506" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-10.png" alt="" class="wp-image-3945" /> </figure> 

最后获取的acsii码值为`102 108 97 103 123 99 100 50 99 51 101 50 102 101 97 52 54 51 100 101 100 57 97 102 56 48 48 100 55 49 53 53 98 101 55 97 113 125`，得出`flag{cd2c3e2fea463ded9af800d7155be7aq}`

## 0x04 CRYPTO A_ CRYPTO 

题目如下：

```
4O595954494Q32515046324757595N534R52415653334357474R4N575955544R4O5N4Q46434S4O59474253464Q5N444R4Q51334557524O5N4S424944473542554O595N44534O324R49565746515532464O49345649564O464R4R494543504N35
```

存在Q、N、R等字母，需要编码转换到A-F，这里采用Rot13解密。放到Cyberchef里面。直接帮着转了hex、base32、base64。<figure class="wp-block-image size-full">

<img loading="lazy" width="3054" height="1342" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-11.png" alt="" class="wp-image-3947" /> </figure> 

然后再转一下base85，注意要更换下字母表，最后得到`flag{W0w_y0u_c4n_rea11y_enc0d1ng!}`<figure class="wp-block-image size-full">

<img loading="lazy" width="1762" height="561" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-12.png" alt="" class="wp-image-3948" /> </figure> 

## 0x05 MISC MISC_2

给了一张猫片，丢到Stegsolve里面查看，发现存在LSB隐写。<figure class="wp-block-image size-full is-resized">

<img loading="lazy" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-13.png" alt="" class="wp-image-3949" width="551" height="427" /> </figure> 

保存一下，提取出来，HTML实体编码为

<pre class="wp-block-code"><code>&#x66;&#x6c;&#x61;&#x67;&#x7b;&#x68;&#x30;&#x77;&#x5f;&#x34;&#x62;&#x6f;&#x75;&#x54;&#x5f;&#x65;&#x6e;&#x63;&#x30;&#x64;&#x65;&#x5f; &#x34;&#x6e;&#x64;&#x5f;&#x70;&#x6e;&#x47;&#x7d;</code></pre>

转换下得到`flag{h0w_4bouT_enc0de_ 4nd_pnG}`。

## 0x06 CRYPTO BABYRSA

<pre class="wp-block-code"><code>from Crypto.Util.number import getPrime, bytes_to_long
from secret import flag

p = getPrime(1024)
q = getPrime(1024)
n = p * q
e = 65537

hint1 = p &gt;&gt; 724
hint2 = q % (2 ** 265)
ct = pow(bytes_to_long(flag), e, n)
print(hint1)
print(hint2)
print(n)
print(ct)</code></pre>

out.txt如下：

```
1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479

40812438243894343296354573724131194431453023461572200856406939246297219541329623

21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969

19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188
```

原题，参考：<a href="http://www.zbc53.top/archives/148/" target="_blank" rel="noreferrer noopener" rel="nofollow" >http://www.zbc53.top/archives/148/</a>

脚本

```python
from gmpy2 import *
from Crypto.Util.number import *

p1 = 1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479
q0 = 40812438243894343296354573724131194431453023461572200856406939246297219541329623
n = 21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969
mod=pow(2,265)
p0=n*invert(q0,mod)%mod
pbar=(p1<<724)+p0
PR.<x> = PolynomialRing(Zmod(n))

for i in range(32):
    f=pbar+x*mod*32
    f=f.monic()
    pp=f.small_roots(X=2^454,beta=0.4)
    if(pp):
        break
    pbar+=mod

p=pbar+pp[0]*32*mod
assert n%p==0
print(p)

q=n//p
phi=(p-1)*(q-1)
e=65537
d=invert(e,phi)
c=19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188
m=pow(c,d,n)
print(long_to_bytes(m))
#flag{ef5e1582-8116-4f61-b458-f793dc03f2ff}
```

## 0x07 CRYPTO CRAZY\_RSA\_TECH

<pre class="wp-block-code"><code>from Crypto.Util.number import *
from Crypto.Util.Padding import *

FLAG = bytes_to_long(pad(b"flag{??????}",64))
def init_key():
    p, q = getPrime(512), getPrime(512)
    n = p*q
    e = 9
    while(GCD((p-1)*(q-1),e)!=1):
        p, q = getPrime(512), getPrime(512)
        n = p*q
    d = inverse(e,(p-1)*(q-1))
    return n,e,d

n_list=list()
c_list=list()
for i in range(9):
    N,e,d=init_key()
    n_list.append(N)
    c=pow(FLAG,e,N)
    c_list.append(pow(FLAG,e,N))
    assert(pow(c,d,N)==FLAG)
print("n_list:",n_list)
print("c_list:",c_list)</code></pre>

给出了9个n\_list和c\_list的值，e很小，属于低加密指数广播攻击。

脚本如下：

```python
from struct import pack,unpack
import zlib
import gmpy


def my_parse_number(number):
    string = "%x" % number
    erg = []
    while string != '':
        erg = erg + [chr(int(string[:2], 16))]
        string = string[2:]
    return ''.join(erg)
    

def extended_gcd(a, b):
    x,y = 0, 1
    lastx, lasty = 1, 0
    while b:
        a, (q, b) = b, divmod(a,b)
        x, lastx = lastx-q*x, x
        y, lasty = lasty-q*y, y
    return (lastx, lasty, a)
    

def chinese_remainder_theorem(items):
  N = 1
  for a, n in items:
    N *= n
  result = 0
  for a, n in items:
    m = N//n
    r, s, d = extended_gcd(n, m)
    if d != 1:
      N=N//n
      continue
    result += a*s*m
  return result % N, N


sessions=[
{"c":62580922178008480377006528793506649089253164524883696044759651305970802215270721223149734532870729533611357047595181907404222690394917605617029675103788705320032707977225447998111744887898039756375876685711148857676502670812333076878964148863713993853526715855758799502735753454247721711366497722251078739585, "e": 9, "n":71189786319102608575263218254922479901008514616376166401353025325668690465852130559783959409002115897148828732231478529655075366072137059589917001875303598680931962384468363842379833044123189276199264340224973914079447846845897807085694711541719515881377391200011269924562049643835131619086349617062034608799},

{"c":46186240819076690248235492196228128599822002268014359444368898414937734806009161030424589993541799877081745454934484263188270879142125136786221625234555265815513136730416539407710862948861531339065039071959576035606192732936477944770308784472646015244527805057990939765708793705044236665364664490419874206900, "e": 9, "n":92503831027754984321994282254005318198418454777812045042619263533423066848097985191386666241913483806726751133691867010696758828674382946375162423033994046273252417389169779506788545647848951018539441971140081528915876529645525880324658212147388232683347292192795975558548712504744297104487514691170935149949},

{"c":85756449024868529058704599481168414715291172247059370174556127800630896693021701121075838517372920466708826412897794900729896389468152213884232173410022054605870785910461728567377769960823103334874807744107855490558726013068890632637193410610478514663078901021307258078678427928255699031215654693270240640198, "e": 9, "n":100993952830138414466948640139083231443558390127247779484027818354177479632421980458019929149817002579508423291678953554090956334137167905685261724759487245658147039684536216616744746196651390112540237050493468689520465897258378216693418610879245129435268327315158194612110422630337395790254881602124839071919},

{"c":14388767329946097216670270960679686032536707277732968784379505904021622612991917314721678940833050736745004078559116326396233622519356703639737886289595860359630019239654690312132039876082685046329079266785042428947147658321799501605837784127004536996628492065409017175037161261039765340032473048737319069656, "e": 9, "n":59138293747457431012165762343997972673625934330232909935732464725128776212729547237438509546925172847581735769773563840639187946741161318153031173864953372796950422229629824699580131369991913883136821374596762214064774480548532035315344368010507644630655604478651898097886873485265848973185431559958627423847},

{"c":1143736792108232890306863524988028098730927600066491485326214420279375304665896453544100447027809433141790331191324806205845009336228331138326163746853197990596700523328423791764843694671580875538251166864957646807184041817863314204516355683663859246677105132100377322669627893863885482167305919925159944839, "e": 9, "n":66827868958054485359731420968595906328820823695638132426084478524423658597714990545142120448668257273436546456116147999073797943388584861050133103137697812149742551913704341990467090049650721713913812069904136198912314243175309387952328961054617877059134151915723594900209641163321839502908705301293546584147},

{"c":2978800921927631161807562509445310353414810029862911925227583943849942080514132963605492727604495513988707849133045851539412276254555228149742924149242124724864770049898278052042163392380895275970574317984638058768854065506927848951716677514095183559625442889028813635385408810698294574175092159389388091981, "e": 9, "n":120940513339890268554625391482989102665030083707530690312336379356969219966820079510946652021721814016286307318930536030308296265425674637215009052078834615196224917417698019787514831973471113022781129000531459800329018133248426080717653298100515701379374786486337920294380753805825328119757649844054966712377},

{"c":16200944263352278316040095503540249310705602580329203494665614035841657418101517016718103326928336623132935178377208651067093136976383774189554806135146237406248538919915426183225265103769259990252162411307338473817114996409705345401251435268136647166395894099897737607312110866874944619080871831772376466376, "e": 9, "n":72186594495190221129349814154999705524005203343018940547856004977368023856950836974465616291478257156860734574686154136925776069045232149725101769594505766718123155028300703627531567850035682448632166309129911061492630709698934310123778699316856399909549674138453085885820110724923723830686564968967391721281},

{"c":31551601425575677138046998360378916515711528548963089502535903329268089950335615563205720969393649713416910860593823506545030969355111753902391336139384464585775439245735448030993755229554555004154084649002801255396359097917380427525820249562148313977941413268787799534165652742114031759562268691233834820996, "e": 9, "n":69105037583161467265649176715175579387938714721653281201847973223975467813529036844308693237404592381480367515044829190066606146105800243199497182114398931410844901178842049915914390117503986044951461783780327749665912369177733246873697481544777183820939967036346862056795919812693669387731294595126647751951},

{"c":25288164985739570635307839193110091356864302148147148153228604718807817833935053919412276187989509493755136905193728864674684139319708358686431424793278248263545370628718355096523088238513079652226028236137381367215156975121794485995030822902933639803569133458328681148758392333073624280222354763268512333515, "e": 9, "n":76194219445824867986050004226602973283400885106636660263597964027139613163638212828932901192009131346530898961165310615466747046710743013409318156266326090650584190382130795884514074647833949281109675170830565650006906028402714868781834693473191228256626654011772428115359653448111208831188721505467497494581},
]



data = []
for session in sessions:
    e=session['e']
    n=session['n']
    msg=session['c']
    data = data + [(msg, n)]
x, n = chinese_remainder_theorem(data)
e=session['e']
realnum = gmpy.mpz(x).root(e)[0].digits()
print (my_parse_number(int(realnum)))
```

解出`flag{H0w_Fun_13_HAstads_broadca5t_AtTack!}`<figure class="wp-block-image size-full">

<img loading="lazy" width="470" height="41" src="https://cdn.jsdelivr.net/gh/Hannibal0x/img/2021/10/图片-14.png" alt="" class="wp-image-3951" /> </figure> 

## 0x08 MISC MI

事后发现是去年钓鱼城杯的原题，贴个大佬的链接。

<a href="http://www.glun.top/2020/10/05/ctf02/" target="_blank" rel="noreferrer noopener" rel="nofollow" >http://www.glun.top/2020/10/05/ctf02/</a>
